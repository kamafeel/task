update proc_schedule_info aa set aa.dura_max =( SELECT round(sum((to_date(l.exec_time, 'yyyy-mm-dd hh24:mi:ss') - to_date(l.start_time, 'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) / count(1),0) a FROM proc_schedule_log l where LENGTH(exec_time) > 0 AND LENGTH(start_time) > 0 AND to_date(l.exec_time, 'yyyy-mm-dd hh24:mi:ss') > to_date(l.start_time, 'yyyy-mm-dd hh24:mi:ss') and to_date(substr(l.start_time, 1, 10), 'yyyy-mm-dd') >= to_date(to_char(sysdate - 30,'yyyy-mm-dd'), 'yyyy-mm-dd') and valid_flag='0' and l.proc_name = aa.proc_name)