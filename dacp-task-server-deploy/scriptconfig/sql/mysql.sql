REPLACE INTO proc_schedule_run_index  SELECT  	DATE_FORMAT(NOW(),'%Y-%m'),   team_code,   xmlid,   proc_name,   run_freq,   2,       TRUNCATE(         SUM(           TIME_TO_SEC(TIMEDIFF(exec_time, end_time))         ) / COUNT(xmlid) / 60,         0       ) index_value,       0,   CURRENT_TIMESTAMP      FROM       proc_schedule_log      WHERE LENGTH(exec_time) > 0        AND LENGTH(end_time) > 0        AND DATEDIFF(CURDATE(), exec_time) < 30        AND valid_flag = '0'  AND task_state = 6    GROUP BY xmlid      HAVING index_value >= 0
REPLACE INTO proc_schedule_run_index  SELECT    DATE_FORMAT(NOW(),'%Y-%m'),   team_code,   xmlid,   proc_name,   run_freq,   0,   SEC_TO_TIME(     TRUNCATE(       SUM(         TIME_TO_SEC(DATE_FORMAT(exec_time, '%T'))       ) / COUNT(xmlid),       0     )   ) AS index_value,   0,   CURRENT_TIMESTAMP  FROM   proc_schedule_log  WHERE exec_time IS NOT NULL    AND run_freq='day'   AND DATEDIFF(CURDATE(), exec_time) < 30    AND valid_flag = '0'  GROUP BY xmlid
REPLACE INTO proc_schedule_run_index  SELECT    DATE_FORMAT(NOW(),'%Y-%m'),   team_code,   xmlid,   proc_name,   run_freq,   1,   SEC_TO_TIME(     TRUNCATE(       SUM(         TIME_TO_SEC(DATE_FORMAT(end_time, '%T'))       ) / COUNT(xmlid),       0     )   ) AS index_value,   0,   CURRENT_TIMESTAMP  FROM   proc_schedule_log  WHERE end_time IS NOT NULL    AND run_freq='day'   AND DATEDIFF(CURDATE(), end_time) < 30    AND valid_flag = '0'    AND task_state = 6  GROUP BY xmlid
REPLACE INTO proc_schedule_run_index  SELECT    DATE_FORMAT(NOW(),'%Y-%m'),   team_code,   xmlid,   proc_name,   run_freq,   0,   FROM_UNIXTIME(     TRUNCATE(       SUM(         UNIX_TIMESTAMP(STR_TO_DATE(exec_time, '%Y-%m-%d %H:%i:%s'))       ) / COUNT(xmlid),       0     )   ,'0000-%m-%d %H:%i:%S') AS index_value,   0,   CURRENT_TIMESTAMP  FROM   proc_schedule_log  WHERE exec_time IS NOT NULL    AND run_freq='month'   AND DATEDIFF(CURDATE(), exec_time) < 365    AND valid_flag = '0'  GROUP BY xmlid
REPLACE INTO proc_schedule_run_index  SELECT    DATE_FORMAT(NOW(),'%Y-%m'),   team_code,   xmlid,   proc_name,   run_freq,   1,   FROM_UNIXTIME(     TRUNCATE(       SUM(         UNIX_TIMESTAMP(STR_TO_DATE(end_time, '%Y-%m-%d %H:%i:%s'))       ) / COUNT(xmlid),       0     )   ,'0000-%m-%d %H:%i:%S') AS index_value,   0,   CURRENT_TIMESTAMP  FROM   proc_schedule_log  WHERE end_time IS NOT NULL    AND run_freq='month'   AND DATEDIFF(CURDATE(), end_time) < 365    AND valid_flag = '0'  GROUP BY xmlid
REPLACE INTO proc_schedule_statistics SELECT LEFT(date_args, 10) AS DATE_ID,team_code,COUNT(*) AS TOTAL_NUM, SUM(CASE WHEN task_state=6 THEN 1 ELSE 0 END ) AS SUC_NUM, SUM(CASE WHEN task_state =51 THEN 1 ELSE 0 END ) AS FAIL_NUM,SUM(CASE WHEN task_state NOT IN (51,6) THEN 1 ELSE 0 END ) AS OTHER_NUM,CURRENT_TIMESTAMP FROM proc_schedule_log WHERE valid_flag=0 AND LEFT(date_args, 10) BETWEEN DATE_SUB(CURDATE(),INTERVAL 8 DAY)  AND CURDATE()  GROUP BY LEFT(date_args, 10),team_code